<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-visual-viewport">
    <title>üö™ „É´„Éº„É† - „ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™</title>
    
    <!-- PWAË®≠ÂÆö -->
    <link rel="manifest" href="/manifest.json?v=4">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/rooms.css" rel="stylesheet">
</head>
<body>
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="rooms-container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <div class="rooms-header">
            <h1>üö™ „É´„Éº„É†</h1>
            <div class="header-tabs">
                <button class="tab-btn active" data-tab="joined">
                    <i class="fas fa-door-open me-1"></i>ÂèÇÂä†‰∏≠
                </button>
                <button class="tab-btn" data-tab="available">
                    <i class="fas fa-search me-1"></i>ÂèÇÂä†ÂèØËÉΩ
                </button>
            </div>
        </div>
        
        <div class="rooms-content">
            <!-- ÂèÇÂä†‰∏≠„ÅÆ„É´„Éº„É† -->
            <div class="tab-content active" id="joined-tab">
                <div class="rooms-list">
                    <div th:if="${userRooms == null or userRooms.isEmpty()}" class="no-rooms">
                        <i class="fas fa-door-closed fa-3x mb-3 text-muted"></i>
                        <p class="text-muted">ÂèÇÂä†„Åó„Å¶„ÅÑ„Çã„É´„Éº„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    </div>
                    
                    <div th:each="room : ${userRooms}" class="room-card" th:onclick="'location.href=\'/chat?room=' + ${room.id} + '\''">
                        <div class="room-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="room-info">
                            <h3 class="room-name" th:text="${room.name}">„É´„Éº„É†Âêç</h3>
                            <p class="room-type" th:text="${room.type == T(com.example.chatapp.entity.ChatRoom.ChatRoomType).GROUP ? '„Ç∞„É´„Éº„Éó' : '„Éó„É©„Ç§„Éô„Éº„Éà'}">„Çø„Ç§„Éó</p>
                        </div>
                        <div class="room-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÂèÇÂä†ÂèØËÉΩ„Å™„É´„Éº„É† -->
            <div class="tab-content" id="available-tab">
                <div class="rooms-list">
                    <div th:if="${availableRooms == null or availableRooms.isEmpty()}" class="no-rooms">
                        <i class="fas fa-inbox fa-3x mb-3 text-muted"></i>
                        <p class="text-muted">ÂèÇÂä†ÂèØËÉΩ„Å™„É´„Éº„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    </div>
                    
                    <div th:each="room : ${availableRooms}" class="room-card">
                        <div class="room-icon">
                            <i class="fas fa-door-open"></i>
                        </div>
                        <div class="room-info">
                            <h3 class="room-name" th:text="${room.name}">„É´„Éº„É†Âêç</h3>
                            <p class="room-type" th:text="${room.type == T(com.example.chatapp.entity.ChatRoom.ChatRoomType).GROUP ? '„Ç∞„É´„Éº„Éó' : '„Éó„É©„Ç§„Éô„Éº„Éà'}">„Çø„Ç§„Éó</p>
                        </div>
                        <button class="btn-join" th:data-room-id="${room.id}">
                            <i class="fas fa-sign-in-alt me-1"></i>ÂèÇÂä†
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- „É´„Éº„É†‰ΩúÊàê„Éú„Çø„É≥ -->
        <a href="/rooms/create" class="btn-create-room">
            <i class="fas fa-plus"></i>
        </a>
    </div>
    
    <!-- „Éï„ÉÉ„Çø„Éº„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
    <footer class="bottom-nav">
        <a href="/home" class="nav-item">
            <i class="fas fa-home"></i>
            <span>„Éõ„Éº„É†</span>
        </a>
        <a href="/rooms" class="nav-item active">
            <i class="fas fa-door-open"></i>
            <span>„É´„Éº„É†</span>
        </a>
        <button class="nav-item">
            <i class="fas fa-random"></i>
            <span>„Éû„ÉÉ„ÉÅ</span>
        </button>
        <button class="nav-item">
            <i class="fas fa-comments"></i>
            <span>„ÉÅ„É£„ÉÉ„Éà</span>
        </button>
        <button class="nav-item">
            <i class="fas fa-user"></i>
            <span>„Éû„Ç§„Éö„Éº„Ç∏</span>
        </button>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                
                // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById(tabName + '-tab').classList.add('active');
            });
        });
        
        // ÂèÇÂä†„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜ
        document.querySelectorAll('.btn-join').forEach(btn => {
            btn.addEventListener('click', async function(e) {
                e.stopPropagation();
                const roomId = this.dataset.roomId;
                
                try {
                    const response = await fetch(`/rooms/${roomId}/join`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        window.location.href = data.redirectUrl;
                    } else {
                        alert(data.message);
                    }
                } catch (error) {
                    alert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                }
            });
        });
    </script>
</body>
</html>
