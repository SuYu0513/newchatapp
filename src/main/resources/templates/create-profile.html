<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-visual-viewport">
    <title>ğŸŒŸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆ - ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª</title>
    
    <!-- PWAè¨­å®š -->
    <link rel="manifest" href="/manifest.json?v=4">
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–è¨­å®š -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/tenkou.css?v=20251225003" rel="stylesheet">
    <link href="/css/create-profile.css?v=20251225001" rel="stylesheet">
</head>
<body>
    <div class="profile-create-kontena">
        <div class="container" style="padding: 0;">
            <div class="row justify-content-center" style="margin: 0;">
                <div class="col-12" style="padding: 0;">
                    <div class="profile-title-area">
                        <h1>âœ¨ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆ</h1>
                        <p>ğŸ’« ã‚ãªãŸã®ã“ã¨ã‚’æ•™ãˆã¦ãã ã•ã„</p>
                    </div>
                    
                    <div class="profile-create-kaado">
                        <div class="profile-create-bodii">
                            <form th:action="@{/profile/create}" method="post" id="profileForm">
                                <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                                <h3 class="profile-section-title"><i class="fas fa-user me-2"></i>åŸºæœ¬æƒ…å ±</h3>
                                
                                <div class="mb-3">
                                    <label for="displayName" class="form-label">è¡¨ç¤ºå</label>
                                    <input type="text" class="form-control" id="displayName" name="displayName" 
                                           th:value="${user.username}" placeholder="ãƒãƒ£ãƒƒãƒˆã§è¡¨ç¤ºã•ã‚Œã‚‹åå‰" maxlength="50" required>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="bio" class="form-label">è‡ªå·±ç´¹ä»‹</label>
                                    <textarea class="form-control" id="bio" name="bio" 
                                              placeholder="ã‚ãªãŸã®ã“ã¨ã‚’ç°¡å˜ã«ç´¹ä»‹ã—ã¦ãã ã•ã„" maxlength="500" rows="4"></textarea>
                                </div>
                                
                                <!-- å¥½ããªã‚‚ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                                <h3 class="profile-section-title"><i class="fas fa-heart me-2"></i>å¥½ããªã‚‚ã®</h3>
                                
                                <!-- äººæ°—ã®ã‚¿ã‚° -->
                                <div class="popular-tags-section" th:if="${topTags != null and !topTags.isEmpty()}">
                                    <span class="popular-tags-label">äººæ°—ã®ã‚¿ã‚°ï¼ˆã‚¯ãƒªãƒƒã‚¯ã—ã¦è¿½åŠ ï¼‰</span>
                                    <div class="tags-container">
                                        <div th:each="tag : ${topTags}" class="tag" th:attr="data-tag=${tag.tagName}" onclick="selectPopularTag(this)">
                                            <span th:text="${tag.tagName}"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ã‚¿ã‚°è¿½åŠ å…¥åŠ› -->
                                <div class="mb-3">
                                    <label for="tagInput" class="form-label">å¥½ããªã‚‚ã®ã‚’è¿½åŠ </label>
                                    <div class="tag-input-area">
                                        <input type="text" class="form-control" id="tagInput" 
                                               placeholder="ä¾‹: ã‚¢ãƒ‹ãƒ¡ã€ã‚²ãƒ¼ãƒ ã€æ—…è¡Œ..." maxlength="30">
                                        <button type="button" class="btn" onclick="addTag()">
                                            <i class="fas fa-plus me-1"></i>è¿½åŠ 
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- é¸æŠã•ã‚ŒãŸã‚¿ã‚°è¡¨ç¤º -->
                                <div class="mb-3">
                                    <label class="form-label">é¸æŠã—ãŸã‚¿ã‚°</label>
                                    <div id="selectedTags" class="tags-container empty"></div>
                                    <div id="tagCounter" class="tag-counter">0 / 30</div>
                                </div>
                                
                                <!-- éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆã‚¿ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§é€ä¿¡ï¼‰ -->
                                <input type="hidden" id="favoriteThings" name="favoriteThings" value="">
                                
                                <button type="submit" class="btn btn-primary mt-3">
                                    <i class="fas fa-check me-2"></i>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆ
                                </button>
                                
                                <a href="/login" class="skip-link">ã‚¹ã‚­ãƒƒãƒ—ã—ã¦å¾Œã§è¨­å®šã™ã‚‹</a>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const MAX_TAGS = 30;
        const selectedTagsSet = new Set();
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªå¤©æ°—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é¸æŠ
        function selectRandomWeather() {
            const weathers = ['sunny', 'cloudy', 'rainy', 'stormy', 'starry'];
            const randomWeather = weathers[Math.floor(Math.random() * weathers.length)];
            
            const container = document.querySelector('.profile-create-kontena');
            if (!container) return;
            
            container.classList.add(randomWeather);
            
            const themeColors = {
                sunny: '#4A90E2',
                cloudy: '#78909C',
                rainy: '#455A64',
                stormy: '#263238',
                starry: '#203A43'
            };
            document.querySelector('meta[name="theme-color"]').setAttribute('content', themeColors[randomWeather]);
            
            switch(randomWeather) {
                case 'rainy':
                    createRain(100);
                    break;
                case 'stormy':
                    createRain(150);
                    createLightning();
                    break;
                case 'starry':
                    createStars(80);
                    break;
            }
        }
        
        function createRain(count) {
            const container = document.querySelector('.profile-create-kontena');
            if (!container) return;
            for (let i = 0; i < count; i++) {
                const drop = document.createElement('div');
                drop.className = 'raindrop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.top = '-50px';
                drop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
                drop.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(drop);
            }
        }
        
        function createStars(count) {
            const container = document.querySelector('.profile-create-kontena');
            if (!container) return;
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                if (Math.random() > 0.8) {
                    star.style.width = '3px';
                    star.style.height = '3px';
                }
                container.appendChild(star);
            }
        }
        
        function createLightning() {
            const container = document.querySelector('.profile-create-kontena');
            if (!container) return;
            const flash = document.createElement('div');
            flash.className = 'lightning-flash';
            container.appendChild(flash);
        }
        
        // äººæ°—ã‚¿ã‚°ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¿½åŠ 
        function selectPopularTag(element) {
            const tagName = element.getAttribute('data-tag');
            if (selectedTagsSet.size >= MAX_TAGS) {
                alert(`ã‚¿ã‚°ã¯æœ€å¤§${MAX_TAGS}å€‹ã¾ã§ã§ã™`);
                return;
            }
            if (!selectedTagsSet.has(tagName)) {
                selectedTagsSet.add(tagName);
                element.classList.add('selected');
                updateSelectedTagsDisplay();
            }
        }
        
        // æ‰‹å…¥åŠ›ã§ã‚¿ã‚°ã‚’è¿½åŠ 
        function addTag() {
            const input = document.getElementById('tagInput');
            const tagName = input.value.trim();
            
            if (!tagName) return;
            
            if (selectedTagsSet.size >= MAX_TAGS) {
                alert(`ã‚¿ã‚°ã¯æœ€å¤§${MAX_TAGS}å€‹ã¾ã§ã§ã™`);
                return;
            }
            
            if (selectedTagsSet.has(tagName)) {
                alert('ã“ã®ã‚¿ã‚°ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                return;
            }
            
            selectedTagsSet.add(tagName);
            input.value = '';
            updateSelectedTagsDisplay();
        }
        
        // é¸æŠã•ã‚ŒãŸã‚¿ã‚°ã®è¡¨ç¤ºã‚’æ›´æ–°
        function updateSelectedTagsDisplay() {
            const container = document.getElementById('selectedTags');
            const counter = document.getElementById('tagCounter');
            const hiddenInput = document.getElementById('favoriteThings');
            
            if (selectedTagsSet.size === 0) {
                container.classList.add('empty');
                container.innerHTML = '';
            } else {
                container.classList.remove('empty');
                container.innerHTML = Array.from(selectedTagsSet).map(tag => `
                    <div class="tag selected">
                        <span>${tag}</span>
                        <button type="button" class="remove-btn" onclick="removeTag('${tag.replace(/'/g, "\\'")}')">Ã—</button>
                    </div>
                `).join('');
            }
            
            // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
            counter.textContent = `${selectedTagsSet.size} / ${MAX_TAGS}`;
            if (selectedTagsSet.size >= MAX_TAGS) {
                counter.classList.add('limit');
            } else {
                counter.classList.remove('limit');
            }
            
            // éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ›´æ–°
            hiddenInput.value = Array.from(selectedTagsSet).join(',');
        }
        
        // ã‚¿ã‚°ã‚’å‰Šé™¤
        function removeTag(tagName) {
            selectedTagsSet.delete(tagName);
            
            // äººæ°—ã‚¿ã‚°ã®é¸æŠçŠ¶æ…‹ã‚‚è§£é™¤
            const popularTag = document.querySelector(`.popular-tags-section .tag[data-tag="${tagName}"]`);
            if (popularTag) {
                popularTag.classList.remove('selected');
            }
            
            updateSelectedTagsDisplay();
        }
        
        // Enterã‚­ãƒ¼ã§ã‚¿ã‚°è¿½åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            selectRandomWeather();
            
            const tagInput = document.getElementById('tagInput');
            tagInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTag();
                }
            });
        });
    </script>
</body>
</html>
