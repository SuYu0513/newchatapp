const ExcelJS = require('exceljs');
const path = require('path');

const workbook = new ExcelJS.Workbook();
workbook.creator = 'ChatApp Test Team';
workbook.created = new Date();

// ===== スタイル定義 =====
const headerFill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF1F3864' } };
const headerFont = { bold: true, color: { argb: 'FFFFFFFF' }, size: 11, name: 'Yu Gothic' };
const bodyFont = { size: 10, name: 'Yu Gothic' };
const thinBorder = {
  top: { style: 'thin' }, bottom: { style: 'thin' },
  left: { style: 'thin' }, right: { style: 'thin' }
};
const wrapAlign = { vertical: 'top', wrapText: true };

const columns = [
  { header: 'No.', key: 'no', width: 6 },
  { header: '大項目', key: 'cat', width: 18 },
  { header: '中項目', key: 'sub', width: 20 },
  { header: 'テスト項目', key: 'item', width: 42 },
  { header: '前提条件', key: 'pre', width: 32 },
  { header: 'テスト手順', key: 'step', width: 48 },
  { header: '期待結果', key: 'expect', width: 48 },
  { header: '実施結果', key: 'result', width: 15 },
  { header: '判定', key: 'judge', width: 8 },
  { header: '備考', key: 'note', width: 20 },
];

function addTestSheet(name, cases) {
  const ws = workbook.addWorksheet(name);
  ws.columns = columns;

  // ヘッダー行スタイル
  const headerRow = ws.getRow(1);
  headerRow.eachCell(cell => {
    cell.fill = headerFill;
    cell.font = headerFont;
    cell.border = thinBorder;
    cell.alignment = { vertical: 'middle', horizontal: 'center' };
  });
  headerRow.height = 24;

  // フリーズペイン
  ws.views = [{ state: 'frozen', ySplit: 1 }];

  // データ行追加
  cases.forEach((c, i) => {
    const row = ws.addRow({
      no: i + 1,
      cat: c[0], sub: c[1], item: c[2],
      pre: c[3], step: c[4], expect: c[5],
      result: '', judge: '', note: ''
    });
    row.eachCell(cell => {
      cell.font = bodyFont;
      cell.border = thinBorder;
      cell.alignment = wrapAlign;
    });
    // 判定列にドロップダウン
    row.getCell('judge').dataValidation = {
      type: 'list', allowBlank: true,
      formulae: ['"OK,NG,保留"']
    };
    row.height = 40;
  });

  // 印刷設定
  ws.pageSetup = {
    orientation: 'landscape', paperSize: 9,
    fitToPage: true, fitToWidth: 1, fitToHeight: 0
  };
  return ws;
}

// ===== 表紙 =====
const cover = workbook.addWorksheet('表紙');
cover.mergeCells('B3:H3');
cover.getCell('B3').value = 'チャットアプリ 結合テスト試験書';
cover.getCell('B3').font = { bold: true, size: 22, name: 'Yu Gothic' };
cover.getCell('B3').alignment = { horizontal: 'center' };

const info = [
  ['プロジェクト名', 'ChatApp'],
  ['試験種別', '結合テスト（全機能）'],
  ['作成日', new Date().toLocaleDateString('ja-JP')],
  ['バージョン', '1.0'],
  ['作成者', ''],
  ['承認者', ''],
];
info.forEach((r, i) => {
  cover.getCell(`C${6 + i}`).value = r[0];
  cover.getCell(`C${6 + i}`).font = { bold: true, size: 11, name: 'Yu Gothic' };
  cover.getCell(`E${6 + i}`).value = r[1];
  cover.getCell(`E${6 + i}`).font = { size: 11, name: 'Yu Gothic' };
});

cover.getCell('C14').value = '【凡例】';
cover.getCell('C14').font = { bold: true, size: 11, name: 'Yu Gothic' };
const legend = [
  ['判定 OK', 'テスト成功'],
  ['判定 NG', 'テスト失敗（不具合あり）'],
  ['判定 保留', '環境・条件不足で実施不可'],
];
legend.forEach((r, i) => {
  cover.getCell(`C${15 + i}`).value = r[0];
  cover.getCell(`C${15 + i}`).font = { bold: true, size: 10, name: 'Yu Gothic' };
  cover.getCell(`E${15 + i}`).value = r[1];
  cover.getCell(`E${15 + i}`).font = { size: 10, name: 'Yu Gothic' };
});

cover.getColumn('C').width = 20;
cover.getColumn('E').width = 40;

// ===== 認証 =====
addTestSheet('認証', [
  ['ログイン', '正常系', '正しい資格情報でログイン', '登録済みユーザーが存在', '1. /loginにアクセス\n2. ユーザー名とパスワードを入力\n3. ログインボタン押下', 'ログイン成功し/homeに遷移する'],
  ['ログイン', '異常系', '誤ったパスワードでログイン', '登録済みユーザーが存在', '1. /loginにアクセス\n2. 正しいユーザー名と誤ったパスワード入力\n3. ログインボタン押下', 'エラーメッセージが表示されログインできない'],
  ['ログイン', '異常系', '未登録ユーザーでログイン', 'なし', '1. /loginにアクセス\n2. 未登録のユーザー名を入力\n3. ログインボタン押下', 'エラーメッセージが表示されログインできない'],
  ['ログイン', '異常系', 'ユーザー名を空でログイン', 'なし', '1. /loginにアクセス\n2. ユーザー名を空のまま送信', 'バリデーションエラーが表示される'],
  ['新規登録', '正常系', '正常な情報で新規登録', 'なし', '1. /registerにアクセス\n2. ユーザー名、パスワード、メールを入力\n3. 登録ボタン押下', '登録成功しプロフィール作成画面に遷移する'],
  ['新規登録', '異常系', '既存ユーザー名で新規登録', '同名ユーザーが存在', '1. /registerにアクセス\n2. 既存のユーザー名で登録', 'ユーザー名重複エラーが表示される'],
  ['新規登録', '異常系', '必須項目を空で新規登録', 'なし', '1. /registerにアクセス\n2. 必須項目を空のまま送信', 'バリデーションエラーが表示される'],
  ['ログアウト', '正常系', 'ログアウト実行', 'ログイン済み', '1. マイページのメニューからログアウト押下', 'ログアウトされログイン画面に遷移する'],
]);

// ===== ホーム =====
addTestSheet('ホーム', [
  ['投稿一覧', '表示', '「すべて」タブで全投稿表示', 'ログイン済み、投稿が存在', '1. ホームタブを開く\n2. 「すべて」タブが選択されていることを確認', '全ユーザーの投稿が新しい順に表示される'],
  ['投稿一覧', '表示', '「フォロー」タブでフォロー中投稿表示', 'フォロー中ユーザーの投稿が存在', '1. 「フォロー」タブをタップ', 'フォロー中ユーザーの投稿のみ表示される'],
  ['投稿一覧', '表示', '投稿がない場合の空表示', 'フォロー中ユーザーの投稿がない', '1. 「フォロー」タブをタップ', '空状態メッセージが表示される'],
  ['投稿一覧', 'リアルタイム', '他ユーザーの新規投稿がリアルタイム反映', '別端末でログイン済み', '1. ホーム画面を開いた状態にする\n2. 別ユーザーが投稿を作成', 'リロードなしで新規投稿がフィードに表示される'],
  ['投稿作成', '正常系', 'テキストのみの投稿', 'ログイン済み', '1. +ボタンタップ\n2. テキストを入力\n3. 投稿ボタン押下', '投稿が作成されホームに戻り投稿が表示される'],
  ['投稿作成', '正常系', '画像付き投稿', 'ログイン済み', '1. +ボタンタップ\n2. テキスト入力\n3. 画像ファイルを選択\n4. プレビュー確認\n5. 投稿ボタン押下', '画像付き投稿が作成され表示される'],
  ['投稿作成', '正常系', '動画付き投稿', 'ログイン済み', '1. +ボタンタップ\n2. テキスト入力\n3. 動画ファイルを選択\n4. 投稿ボタン押下', '動画付き投稿が作成され表示される'],
  ['投稿作成', '正常系', 'メディアのドラッグ&ドロップ', 'ログイン済み', '1. +ボタンタップ\n2. 画像をドラッグ&ドロップ', 'プレビューが表示される'],
  ['投稿作成', '正常系', 'メディアプレビュー削除', 'メディアが添付済み', '1. プレビュー上の×ボタンをタップ', 'プレビューが削除され添付が解除される'],
  ['投稿作成', '異常系', '本文を空で投稿', 'ログイン済み', '1. +ボタンタップ\n2. 何も入力せず投稿ボタン押下', '投稿されない（ボタン非活性またはエラー）'],
  ['投稿作成', 'バリデーション', '文字数カウンター表示', 'ログイン済み', '1. +ボタンタップ\n2. テキストを入力', '0/1000のカウンターがリアルタイム更新される'],
  ['投稿作成', 'バリデーション', '1000文字上限', 'ログイン済み', '1. 1000文字を超えるテキストを入力', '1000文字以降は入力できないまたは警告が出る'],
  ['画像モーダル', '表示', '投稿画像をタップで拡大表示', '画像付き投稿が表示されている', '1. 投稿の画像をタップ', '画像がフルスクリーンモーダルで表示される'],
  ['画像モーダル', '操作', 'モーダルを閉じる', '画像モーダルが表示中', '1. モーダル外をタップまたは閉じるボタン', 'モーダルが閉じて元の画面に戻る'],
  ['ユーザー遷移', '操作', '投稿者のアバター/名前タップ', '投稿が表示されている', '1. 投稿者のアバターまたは名前をタップ', 'そのユーザーのプロフィール画面に遷移する'],
]);

// ===== ルーム =====
addTestSheet('ルーム', [
  ['参加中', '表示', '参加中ルーム一覧表示', 'ルームに参加済み', '1. ルームタブを開く', '参加中のルーム一覧が表示される'],
  ['参加中', '表示', '参加ルームがない場合の空表示', 'ルーム未参加', '1. ルームタブを開く', '空状態メッセージが表示される'],
  ['参加中', '操作', 'ルームをタップしてチャット画面へ', 'ルームに参加済み', '1. ルーム一覧からルームをタップ', 'ルームチャット画面に遷移しメッセージ履歴が表示される'],
  ['参加可能', '表示', '参加可能な公開ルーム一覧', '公開ルームが存在', '1. 「参加可能」タブをタップ', '未参加の公開ルーム一覧が表示される'],
  ['参加可能', '操作', '公開ルームに参加', '公開ルームが表示されている', '1. 参加ボタンをタップ', 'ルームに参加し「参加中」タブに表示される'],
  ['参加可能', '操作', '非公開ルームに参加申請', '非公開ルームが表示されている', '1. 参加申請ボタンをタップ', '申請が送信され「申請」タブに表示される'],
  ['申請', '表示', '申請中ルーム一覧表示', '参加申請を送信済み', '1. 「申請」タブをタップ', '申請中ルームが「承認待ち」で表示される'],
  ['申請', '操作', '申請キャンセル', '申請中ルームが存在', '1. 「申請」タブを開く\n2. キャンセルボタンをタップ', '申請が取り消され一覧から消える'],
  ['申請', 'バッジ', '申請バッジ表示', '申請中ルームが存在', '1. ルームタブを開く', '「申請」タブにバッジ数が表示される'],
  ['承認', '表示', '承認待ち一覧表示', '自分が作成したルームに申請がある', '1. 「承認」タブをタップ', '申請者の情報と承認/拒否ボタンが表示される'],
  ['承認', '操作', '参加申請を承認', '承認待ち申請が存在', '1. 「承認」タブを開く\n2. 承認ボタンをタップ', '申請者がルームに参加し一覧から消える'],
  ['承認', '操作', '参加申請を拒否', '承認待ち申請が存在', '1. 「承認」タブを開く\n2. 拒否ボタンをタップ', '申請が拒否され一覧から消える'],
  ['承認', 'バッジ', '承認バッジ表示', '承認待ち申請が存在', '1. ルームタブを開く', '「承認」タブにバッジ数が表示される'],
  ['招待', '表示', '受信した招待一覧表示', '招待を受信済み', '1. 「招待」タブをタップ', '招待元とルーム情報が表示される'],
  ['招待', '操作', '招待を承諾', '招待が存在', '1. 「招待」タブを開く\n2. 承諾ボタンをタップ', 'ルームに参加し「参加中」に表示される'],
  ['招待', '操作', '招待を拒否', '招待が存在', '1. 「招待」タブを開く\n2. 拒否ボタンをタップ', '招待が削除され一覧から消える'],
  ['招待', 'バッジ', '招待バッジ表示', '招待が存在', '1. ルームタブを開く', '「招待」タブにバッジ数が表示される'],
  ['ルーム作成', '正常系', '公開ルーム作成', 'ログイン済み', '1. +ボタンタップ\n2. ルーム名を入力\n3. 公開設定をON\n4. 作成ボタン押下', 'ルームが作成され参加中に表示される'],
  ['ルーム作成', '正常系', '非公開ルーム作成', 'ログイン済み', '1. +ボタンタップ\n2. ルーム名を入力\n3. 公開設定をOFF\n4. 作成ボタン押下', '非公開ルームが作成される'],
  ['ルーム作成', '正常系', 'フレンド招待付きで作成', 'フレンドが存在', '1. +ボタンタップ\n2. ルーム名入力\n3. フレンドを選択\n4. 作成', 'ルーム作成＆選択フレンドに招待が送信される'],
  ['ルーム作成', '異常系', 'ルーム名を空で作成', 'ログイン済み', '1. +ボタンタップ\n2. ルーム名を空のまま作成', 'バリデーションエラーが表示される'],
  ['ルームチャット', '送信', 'メッセージ送信', 'ルームチャット画面を表示中', '1. メッセージを入力\n2. 送信ボタンまたはEnterキー', 'メッセージが送信され画面に表示される'],
  ['ルームチャット', 'リアルタイム', '他メンバーからのメッセージ受信', '同じルームに他メンバーがいる', '1. ルームチャット画面を開いた状態\n2. 他メンバーがメッセージ送信', 'リアルタイムでメッセージが表示される'],
  ['ルームチャット', '操作', 'メッセージ履歴の自動スクロール', 'メッセージ履歴が多い', '1. ルームチャット画面を開く', '最新メッセージまで自動スクロールされる'],
  ['メンバー管理', '表示', 'メンバー一覧表示', 'ルームチャット画面を表示中', '1. メンバーリストボタンをタップ', 'ルームメンバー一覧が表示される'],
  ['メンバー管理', '操作', 'メンバーをキック（作成者のみ）', 'ルーム作成者としてログイン', '1. メンバー一覧を開く\n2. キックボタンをタップ', 'メンバーがルームから除外される'],
  ['メンバー管理', '操作', '追加招待を送信', 'ルームチャット画面を表示中', '1. 招待ボタンをタップ\n2. フォロワーを選択\n3. 招待送信', '選択したユーザーに招待が送信される'],
  ['ルームアイコン', '操作', 'アイコンアップロード（作成者のみ）', 'ルーム作成者としてログイン', '1. ルームアイコンをタップ\n2. 画像ファイルを選択', 'アイコンがアップロードされ表示が更新される'],
  ['フッターバッジ', 'リアルタイム', 'ルームタブのメインフッターバッジ', '招待/承認/申請がある', '1. ルームタブ以外の画面にいる', 'メインフッターのルームタブにバッジ合計が表示される'],
  ['フッターバッジ', '操作', 'ルームタブを開くとバッジクリア', 'バッジが表示されている', '1. ルームタブをタップ', 'メインフッターのバッジが消える'],
  ['リアルタイム', 'WebSocket', 'ルーム更新のリアルタイム通知', '別ユーザーがルーム操作を実行', '1. ルームタブを開いた状態\n2. 別ユーザーがルーム作成/招待/申請', 'リアルタイムで一覧が更新される'],
]);

// ===== マッチ =====
addTestSheet('マッチ', [
  ['ソート', '近所', '近所タブで住所近い順に表示', 'マッチング有効、住所設定済み、候補者あり', '1. マッチタブを開く\n2. 「近所」タブをタップ', '住所が近い候補者が優先表示される'],
  ['ソート', '趣味', '趣味タブでタグ一致順に表示', '好きなものタグ設定済み', '1. 「趣味」タブをタップ', '共通タグが多い候補者が優先表示される'],
  ['ソート', '年齢', '年齢タブで年齢近い順に表示', '年齢情報設定済み', '1. 「年齢」タブをタップ', '年齢が近い候補者が優先表示される'],
  ['ソート', '運命', '運命タブで総合スコア順に表示', 'プロフィール情報設定済み', '1. 「運命」タブをタップ', '総合スコア高い候補者が優先表示される'],
  ['候補者除外', 'フィルタ', 'フレンドが候補に表示されない', '相互フォローのフレンドが存在', '1. マッチタブを開く', 'フレンドが候補者に含まれない'],
  ['候補者除外', 'フィルタ', 'フォロー中ユーザーが候補に出ない', 'フォロー中ユーザーが存在', '1. マッチタブを開く', 'フォロー中ユーザーが候補者に含まれない'],
  ['候補者除外', 'フィルタ', 'フォロワーが候補に出ない', 'フォロワーが存在', '1. マッチタブを開く', 'フォロワーが候補者に含まれない'],
  ['候補者除外', 'フィルタ', 'マッチ成立者が候補に出ない', '相互いいね済みユーザーが存在', '1. マッチタブを開く', 'マッチ成立済みユーザーが候補者に含まれない'],
  ['候補者除外', 'フィルタ', '写真未設定ユーザーが候補に出ない', 'マッチ写真未設定ユーザーが存在', '1. マッチタブを開く', '写真未設定ユーザーが候補者に含まれない'],
  ['スワイプ', '右スワイプ', 'カードを右スワイプでいいね', '候補者が表示されている', '1. カードを右にスワイプ', 'LIKEスタンプ表示→カード飛出→いいね送信される'],
  ['スワイプ', '左スワイプ', 'カードを左スワイプでスキップ', '候補者が表示されている', '1. カードを左にスワイプ', 'NOPEスタンプ表示→カード飛出→次の候補者表示'],
  ['スワイプ', 'ボタン', 'いいねボタンでlike', '候補者が表示されている', '1. ハートボタンをタップ', 'カードが右に飛出しいいねが送信される'],
  ['スワイプ', 'ボタン', 'スキップボタンでskip', '候補者が表示されている', '1. ×ボタンをタップ', 'カードが左に飛出し次の候補者が表示される'],
  ['スワイプ', '完了', '全候補者確認後の表示', '候補者を全てスワイプ済み', '1. 最後の候補者をスワイプ', '「候補者を全て確認しました」と表示される'],
  ['マッチ成立', '通知', '相互いいねでマッチ通知表示', '相手が先にいいね済み', '1. 相手のカードを右スワイプ', 'マッチ成立通知オーバーレイが表示される'],
  ['いいねタブ', '表示', '送ったいいね一覧がスワイプカードで表示', 'いいね送信済みユーザーが存在', '1. サブフッターの「いいね」タブをタップ', 'いいね済みユーザーがスワイプカードで表示される'],
  ['いいねタブ', '左スワイプ', '左スワイプでいいね取り消し', 'いいねタブを表示中', '1. カードを左にスワイプ', 'いいねが取り消され一覧から消える'],
  ['いいねタブ', '右スワイプ不可', '右スワイプが無効', 'いいねタブを表示中', '1. カードを右にスワイプ', '抵抗感がありスワイプが成立しない'],
  ['いいねタブ', 'ボタン', '×ボタンのみ表示される', 'いいねタブを表示中', '1. アクションボタンを確認', '×ボタンのみ表示されハートボタンはない'],
  ['もらったタブ', '表示', '受信いいね一覧がスワイプカードで表示', 'いいねを受信済み', '1. 「もらった」タブをタップ', '受信いいねユーザーがスワイプカードで表示される'],
  ['もらったタブ', '右スワイプ', '右スワイプでいいね返し', 'もらったタブを表示中', '1. カードを右にスワイプ', 'いいねが送信されマッチ成立通知が表示される'],
  ['もらったタブ', '左スワイプ', '左スワイプで拒否', 'もらったタブを表示中', '1. カードを左にスワイプ', '相手のいいねが削除され一覧から消える'],
  ['もらったタブ', 'ボタン', '×ボタンとハートボタンが両方表示', 'もらったタブを表示中', '1. アクションボタンを確認', '×ボタンとハートボタンの両方が表示される'],
  ['マッチタブ', '表示', '相互いいね一覧がリスト表示', '相互いいね成立済み', '1. 「マッチ」タブをタップ', 'マッチ成立ユーザーがリスト形式で表示される'],
  ['マッチタブ', '除外', 'マッチ成立者がいいね/もらったに表示されない', '相互いいね成立済み', '1. 「いいね」タブを確認\n2. 「もらった」タブを確認', 'マッチ成立者はどちらにも表示されない'],
  ['サブバッジ', '表示', 'サブフッターバッジが新着のみ表示', 'いいね/もらった/マッチが存在', '1. マッチタブを開く', '未確認の件数のみバッジに表示される'],
  ['サブバッジ', '既読', 'サブタブを開くとバッジが消える', 'バッジが表示されている', '1. バッジ付きサブタブをタップ', 'そのタブのバッジが消える'],
  ['サブバッジ', '永続化', 'アプリ再起動後もバッジが復活しない', 'サブタブを既読済み', '1. アプリを閉じて再度開く', '既読済みタブのバッジは表示されない'],
  ['メインバッジ', '表示', 'メインフッターにいいね+もらった+マッチの合計表示', '未確認の通知がある', '1. マッチタブ以外の画面にいる', 'メインフッターのマッチタブに合計数バッジが表示される'],
  ['メインバッジ', '既読', 'マッチタブを開くとバッジクリア', 'メインバッジが表示されている', '1. マッチタブをタップ', 'メインフッターのバッジが消える'],
  ['メインバッジ', '永続化', 'アプリ再起動後もバッジが復活しない', 'マッチタブを既読済み', '1. アプリを閉じて再度開く', '既読済みならバッジは表示されない'],
  ['リアルタイム', 'WebSocket', 'いいね受信のリアルタイム通知', '別ユーザーがいいねを送信', '1. アプリを開いた状態\n2. 別ユーザーが自分にいいね', 'トースト通知が表示されバッジが更新される'],
  ['リアルタイム', 'WebSocket', 'マッチ成立のリアルタイム通知', '相互いいねが成立', '1. アプリを開いた状態\n2. 別ユーザーがいいね返し→マッチ成立', 'マッチ成立通知が表示されバッジが更新される'],
  ['リアルタイム', 'WebSocket', '新着通知でバッジ既読リセット', '一度バッジを既読済み', '1. サブタブを既読にする\n2. 新しいいいねを受信', '新着分のバッジが再表示される'],
]);

// ===== チャット =====
addTestSheet('チャット', [
  ['DM一覧', '表示', '「すべて」タブでDM一覧表示', 'DM会話が存在', '1. チャットタブを開く', '全DM会話が最新メッセージ順に表示される'],
  ['DM一覧', '表示', '「フレンド」タブでフレンドのみ表示', 'フレンドとのDMが存在', '1. 「フレンド」タブをタップ', 'フレンド（相互フォロー）とのDMのみ表示される'],
  ['DM一覧', '表示', '最終メッセージプレビュー表示', 'DM会話が存在', '1. チャットタブを開く', '各会話に最終メッセージのプレビューが表示される'],
  ['DM一覧', '表示', '未読バッジ表示', '未読メッセージがある', '1. チャットタブを開く', '未読会話にバッジ（未読数）が表示される'],
  ['DM一覧', '表示', '会話がない場合の空表示', 'DM会話が存在しない', '1. チャットタブを開く', '空状態メッセージが表示される'],
  ['DM送信', '正常系', 'メッセージ送信', 'DM画面を表示中', '1. メッセージを入力\n2. 送信ボタンまたはEnterキー', 'メッセージが送信され画面に表示される'],
  ['DM送信', '異常系', '空メッセージ送信', 'DM画面を表示中', '1. 何も入力せず送信', '送信されない'],
  ['DM受信', 'リアルタイム', 'メッセージのリアルタイム受信', 'DM画面を開いた状態', '1. 別ユーザーがDMを送信', 'リアルタイムでメッセージが表示される'],
  ['DM受信', 'リアルタイム', 'DM一覧でのリアルタイム更新', 'チャット一覧画面', '1. 別ユーザーがDMを送信', '一覧のプレビューと未読バッジがリアルタイム更新される'],
  ['既読', '自動', 'DM画面を開くと既読になる', '未読メッセージがある', '1. 未読のDM会話をタップして開く', 'メッセージが既読になり相手に既読通知が送信される'],
  ['既読', 'リアルタイム', '相手の既読がリアルタイム反映', 'DM画面を開いた状態', '1. 相手がDM画面を開く', '既読状態がリアルタイムで更新される'],
  ['未読バッジ', '表示', 'チャットタブの未読バッジ', '未読DMがある', '1. チャット以外のタブにいる', 'メインフッターのチャットタブに未読数が表示される'],
  ['未読バッジ', '既読', 'チャットタブを開くとバッジクリア', 'バッジが表示されている', '1. チャットタブをタップ', 'メインフッターのバッジが消える'],
  ['DM開始', 'プロフィール経由', 'ユーザープロフィールからDM開始', '他ユーザーのプロフィールを表示中', '1. DMボタンをタップ', 'DM画面に遷移し会話が開始される'],
  ['DM開始', 'フレンド経由', 'フレンドリストからDM開始', 'フレンドが存在', '1. フレンドリストからDMボタンをタップ', 'DM画面に遷移し会話が開始される'],
  ['DM開始', '既存会話', '既存会話がある相手とDM開始', '既にDM会話が存在する相手', '1. プロフィールからDMボタンをタップ', '既存の会話画面が開き過去メッセージが表示される'],
]);

// ===== マイページ =====
addTestSheet('マイページ', [
  ['プロフィール', '表示', 'アバター表示', 'アバター設定済み', '1. マイページタブを開く', 'アバター画像が表示される'],
  ['プロフィール', '表示', 'アバター未設定時のデフォルト表示', 'アバター未設定', '1. マイページタブを開く', 'デフォルトアイコンが表示される'],
  ['プロフィール', '表示', '表示名・ユーザー名表示', 'プロフィール設定済み', '1. マイページタブを開く', '表示名と@ユーザー名が表示される'],
  ['プロフィール', '表示', '自己紹介表示', '自己紹介設定済み', '1. マイページタブを開く', '自己紹介文が表示される'],
  ['プロフィール', '表示', 'フレンドコード表示', 'ログイン済み', '1. マイページタブを開く', 'フレンドコードが表示される'],
  ['プロフィール', '表示', '好きなものタグ表示', 'タグ設定済み', '1. マイページタブを開く', '好きなものタグが横スクロールで表示される'],
  ['統計', '表示', 'フォロー数表示', 'フォロー中ユーザーが存在', '1. マイページタブを開く', '正しいフォロー数が表示される'],
  ['統計', '表示', 'フォロワー数表示', 'フォロワーが存在', '1. マイページタブを開く', '正しいフォロワー数が表示される'],
  ['統計', '表示', 'フレンド数表示', '相互フォローが存在', '1. マイページタブを開く', '正しいフレンド数が表示される'],
  ['統計', '操作', 'フォロー数タップで一覧表示', 'フォロー中ユーザーが存在', '1. フォロー数をタップ', 'フォロー中ユーザー一覧が表示される'],
  ['統計', '操作', 'フォロワー数タップで一覧表示', 'フォロワーが存在', '1. フォロワー数をタップ', 'フォロワー一覧が表示される'],
  ['統計', '操作', 'フレンド数タップで一覧表示', '相互フォローが存在', '1. フレンド数をタップ', 'フレンド一覧が表示される'],
  ['投稿', '表示', '自分の投稿一覧表示', '投稿が存在', '1. マイページタブを開く', '自分の投稿が一覧表示される'],
  ['投稿', '表示', '投稿がない場合の空表示', '投稿なし', '1. マイページタブを開く', '空状態メッセージが表示される'],
  ['メニュー', '操作', 'ハンバーガーメニュー開閉', 'マイページ表示中', '1. メニューボタンをタップ\n2. もう一度タップまたは外側をタップ', 'メニューが開閉する'],
  ['メニュー', '遷移', 'プロフ編集への遷移', 'メニューが開いている', '1. 「プロフ編集」をタップ', '/profile/editに遷移する'],
  ['メニュー', '遷移', 'マッチング設定への遷移', 'メニューが開いている', '1. 「マッチ設定」をタップ', '/random-matching/settingsに遷移する'],
  ['メニュー', '遷移', 'ログアウト', 'メニューが開いている', '1. 「ログアウト」をタップ', 'ログアウトされログイン画面に遷移する'],
  ['他ユーザー', '表示', '他ユーザーのプロフィール表示', 'なし', '1. 投稿やリストからユーザーをタップ', 'プロフィール画面にアバター、名前、自己紹介等が表示される'],
  ['他ユーザー', '操作', 'フォローする', '未フォローのユーザープロフィールを表示中', '1. 「フォロー」ボタンをタップ', 'フォロー状態になりボタンが「フォロー中」に変わる'],
  ['他ユーザー', '操作', 'アンフォローする', 'フォロー中のユーザープロフィールを表示中', '1. 「フォロー中」ボタンをタップ', 'フォロー解除されボタンが「フォロー」に変わる'],
  ['他ユーザー', '操作', 'DMボタンからDM開始', '他ユーザープロフィールを表示中', '1. 「DM」ボタンをタップ', 'DM画面に遷移する'],
  ['他ユーザー', '表示', '関係性に応じたボタン表示', '各関係性のユーザーが存在', '1. 各ユーザーのプロフィールを確認', '未フォロー→「フォロー」、フォロー中→「フォロー中」+DM、フレンド→「フレンド」+DM'],
  ['バッジ', '表示', 'マイページバッジ表示', 'フレンドリクエストがある', '1. マイページ以外の画面にいる', 'メインフッターのマイページタブにバッジが表示される'],
  ['バッジ', '既読', 'マイページを開くとバッジクリア', 'バッジが表示されている', '1. マイページタブをタップ', 'メインフッターのバッジが消える'],
]);

// ===== プロフィール編集 =====
addTestSheet('プロフィール編集', [
  ['アバター', 'アップロード', '画像を選択してアバター設定', '/profile/editを表示中', '1. アバターエリアをタップ\n2. 画像ファイルを選択\n3. クロップモーダルで調整\n4. 確定', 'アバターがアップロードされプレビューが更新される'],
  ['アバター', 'クロップ', 'ズーム操作', 'クロップモーダルが表示中', '1. ズームスライダーを操作', '画像が拡大/縮小される'],
  ['アバター', 'クロップ', 'ドラッグ操作', 'クロップモーダルが表示中', '1. 画像をドラッグして位置調整', '画像の表示位置が変わる'],
  ['アバター', '削除', 'アバターを削除', 'アバター設定済み', '1. 削除ボタンをタップ', 'アバターが削除されデフォルト表示に戻る'],
  ['基本情報', '入力', '表示名を変更', '/profile/editを表示中', '1. 表示名フィールドに入力\n2. 保存ボタン押下', '表示名が更新される'],
  ['基本情報', '入力', '自己紹介を変更', '/profile/editを表示中', '1. 自己紹介フィールドに入力\n2. 保存ボタン押下', '自己紹介が更新される'],
  ['基本情報', '入力', 'ステータスメッセージを変更', '/profile/editを表示中', '1. ステータスフィールドに入力\n2. 保存ボタン押下', 'ステータスが更新される'],
  ['基本情報', 'カウンター', '文字数カウンター表示', '/profile/editを表示中', '1. 各テキストフィールドに入力', '文字数カウンターがリアルタイム更新される'],
  ['住所', '選択', '都道府県→市区町村の選択', '/profile/editを表示中', '1. 都道府県を選択\n2. 市区町村を選択\n3. 確定', '住所が設定される'],
  ['住所', '選択', '都道府県のみで確定', '/profile/editを表示中', '1. 都道府県を選択\n2. 確定', '都道府県のみで住所が設定される'],
  ['タグ', '追加', 'タグを追加', '/profile/editを表示中', '1. タグ入力フィールドに入力\n2. Enterまたは追加ボタン', 'タグが追加されて表示される'],
  ['タグ', '削除', 'タグを削除', 'タグが存在', '1. タグの×ボタンをタップ', 'タグが削除される'],
  ['タグ', '上限', 'タグ30件の上限', 'タグが29件', '1. 30件目のタグを追加\n2. 31件目のタグを追加', '30件目は追加される、31件目は追加できない'],
  ['タグ', '重複', '重複タグの追加', '既にタグが存在', '1. 同じ名前のタグを追加', '重複タグは追加されない'],
  ['保存', '正常系', '全項目を入力して保存', '各フィールドに値を入力済み', '1. 保存ボタンを押下', '成功メッセージが表示されホームに遷移する'],
  ['保存', '正常系', '一部項目のみ変更して保存', '/profile/editを表示中', '1. 表示名のみ変更\n2. 保存ボタン押下', '変更した項目のみ更新される'],
  ['保存', '異常系', '文字数上限超過', '/profile/editを表示中', '1. 表示名に51文字以上入力\n2. 保存', '入力が制限されるまたはエラーが表示される'],
  ['年齢グループ', '選択', '年齢グループを変更', '/profile/editを表示中', '1. 年齢グループのプルダウンから選択\n2. 保存', '年齢グループが更新される'],
  ['チャットスタイル', '選択', 'チャットスタイルを変更', '/profile/editを表示中', '1. チャットスタイルのプルダウンから選択\n2. 保存', 'チャットスタイルが更新される'],
]);

// ===== マッチング設定 =====
addTestSheet('マッチング設定', [
  ['マッチング許可', 'ON/OFF', 'マッチングを有効にする', '/random-matching/settingsを表示中', '1. 「マッチングを許可」をONに切替\n2. 保存', 'マッチング候補に表示されるようになる'],
  ['マッチング許可', 'ON/OFF', 'マッチングを無効にする', 'マッチングが有効', '1. 「マッチングを許可」をOFFに切替\n2. 保存', 'マッチング候補に表示されなくなる'],
  ['写真', 'アップロード', '1枚目の写真アップロード', 'マッチング有効', '1. 写真スロットをタップ\n2. 画像ファイルを選択', '写真がアップロードされスロットに表示される'],
  ['写真', 'アップロード', '6枚まで写真アップロード', '写真が5枚', '1. 6枚目の写真をアップロード', '6枚目が追加される'],
  ['写真', '上限', '7枚目のアップロード試行', '写真が6枚', '1. 7枚目をアップロード試行', 'アップロードできない（上限エラー）'],
  ['写真', '削除', '写真を削除', '写真がアップロード済み', '1. 写真の×ボタンをタップ', '写真が削除されスロットが空になる'],
  ['写真', 'バリデーション', '写真なしでマッチ有効保存', 'マッチング有効、写真0枚', '1. 保存ボタンを押下', '「マッチング用の写真が設定されていません」エラーが表示され保存されない'],
  ['年齢範囲', '設定', '年齢範囲を変更', '/random-matching/settingsを表示中', '1. 最小年齢と最大年齢を設定\n2. 保存', '年齢範囲が更新される'],
  ['好きなもの', '選択', '好きなものを個別選択', 'プロフィールにタグ設定済み', '1. 好きなものリストから選択\n2. 保存', '選択した項目が保存される'],
  ['好きなもの', '一括選択', 'すべて選択ボタン', 'プロフィールにタグ設定済み', '1. 「すべて選択」ボタンをタップ', '全項目が選択される'],
  ['好きなもの', '一括解除', 'すべて解除ボタン', '全項目が選択済み', '1. 「すべて解除」ボタンをタップ', '全項目の選択が解除される'],
  ['プライバシー', '設定', 'プロフィール公開範囲変更', '/random-matching/settingsを表示中', '1. 公開範囲を選択\n2. 保存', '公開範囲が更新される'],
  ['通知', '設定', 'マッチ通知ON/OFF', '/random-matching/settingsを表示中', '1. マッチ通知を切替\n2. 保存', '通知設定が更新される'],
  ['通知', '設定', 'メッセージ通知ON/OFF', '/random-matching/settingsを表示中', '1. メッセージ通知を切替\n2. 保存', '通知設定が更新される'],
  ['リセット', '操作', 'デフォルトにリセット', '設定を変更済み', '1. 「デフォルトにリセット」ボタンをタップ\n2. 確認ダイアログで「OK」', '全設定がデフォルト値に戻る'],
  ['保存', '正常系', '設定を保存', '各項目を設定済み', '1. 保存ボタンを押下', '「設定を保存しました」メッセージが表示される'],
]);

// ===== AIチャット =====
addTestSheet('AIチャット', [
  ['タブ', '表示', 'AIタブが表示される', 'ログイン済み', '1. チャットタブを開く', '「すべて」「フレンド」「AI」タブが表示される'],
  ['タブ', '切替', 'AIタブに切り替え', 'チャットタブを表示中', '1. 「AI」タブをタップ', 'AIチャット画面が表示される'],
  ['UI', '表示', 'ウェルカムメッセージ表示', 'AIタブを開く', '1. AIタブを選択', 'AIアシスタントからのウェルカムメッセージが表示される'],
  ['UI', '表示', '入力欄と送信ボタン表示', 'AIタブを表示中', '1. 画面を確認', '入力欄、送信ボタン、クリアボタンが表示される'],
  ['送信', '正常系', 'メッセージを送信', 'AIタブを表示中、APIキー設定済み', '1. 入力欄にメッセージを入力\n2. 送信ボタンをタップ', 'ユーザーメッセージが表示され、AIからの返答が表示される'],
  ['送信', '正常系', 'Enterキーで送信', 'AIタブを表示中', '1. 入力欄にメッセージを入力\n2. Enterキーを押す', 'メッセージが送信される'],
  ['送信', '異常系', '空メッセージ送信', 'AIタブを表示中', '1. 何も入力せず送信', '送信されない'],
  ['送信', 'ローディング', '送信中のローディング表示', 'AIタブを表示中', '1. メッセージを送信', '返答待ちの間、ローディングアニメーション（...）が表示される'],
  ['履歴', '保持', '会話履歴が保持される', '複数回メッセージを送受信', '1. 複数メッセージを送信\n2. 別タブに移動\n3. AIタブに戻る', '過去の会話履歴が表示されている'],
  ['履歴', 'クリア', '履歴をクリア', '会話履歴がある', '1. クリアボタンをタップ\n2. 確認ダイアログで「OK」', '会話履歴がクリアされウェルカムメッセージのみ表示される'],
  ['履歴', 'キャンセル', 'クリアをキャンセル', '会話履歴がある', '1. クリアボタンをタップ\n2. 確認ダイアログで「キャンセル」', '会話履歴は削除されない'],
  ['表示', 'バブル', 'ユーザーメッセージが右寄せ', 'メッセージ送信後', '1. メッセージを確認', 'ユーザーメッセージが右側に紫色のバブルで表示される'],
  ['表示', 'バブル', 'AIメッセージが左寄せ', 'AI返答後', '1. メッセージを確認', 'AIメッセージがロボットアイコンと共に左側に表示される'],
  ['表示', 'スクロール', '自動スクロール', '複数メッセージ送受信', '1. 複数メッセージを送信', '新しいメッセージが表示されるたびに自動で最下部にスクロールする'],
  ['API未設定', 'エラー', 'APIキー未設定時のメッセージ', 'GEMINI_API_KEY環境変数が未設定', '1. メッセージを送信', 'APIキー設定を促すメッセージが返される'],
  ['APIエラー', '401', '無効なAPIキー', 'APIキーが不正', '1. メッセージを送信', '「APIキーが無効です」というエラーメッセージが表示される'],
  ['APIエラー', '429', 'レート制限', 'リクエスト上限に達した', '1. 連続でメッセージを送信', '「利用制限に達しました」というエラーメッセージが表示される'],
  ['入力欄', 'リサイズ', 'テキストエリアの自動リサイズ', 'AIタブを表示中', '1. 複数行のテキストを入力', 'テキストエリアが入力に合わせて高さが変わる'],
  ['入力欄', '改行', 'Shift+Enterで改行', 'AIタブを表示中', '1. テキストを入力\n2. Shift+Enterを押す', '送信されず改行が入力される'],
]);

// ===== ファイル保存 =====
const outputPath = path.join(__dirname, 'test-cases.xlsx');
workbook.xlsx.writeFile(outputPath).then(() => {
  console.log('Excel file generated: ' + outputPath);
}).catch(err => {
  console.error('Error:', err);
});
